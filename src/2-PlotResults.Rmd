---
title: "Explore results of the ocean climate novelty"
author: "Katie Lotterhos"
date: "6/27/2019"
output: html_document
---
  
setwd("~/Desktop/Repos/OceanClimateNovelty/src")  
  
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source("0-Novelty_Oceans_Functions.R")
```



```{r load data}

dat_Nov <- fread("../results/SigmaD.csv")
dat4.5 <- fread("../data/large_files/T_Ar_Ca_pH_RCP45.txt", sep = ",")
dat8.5 <- fread("../data/large_files/T_Ar_Ca_pH_RCP85.txt", sep = ",")
```

# Plot distribution of temperature and omega_arag at 1800, 2000, and 2100
```{r}

plot(dat8.5$SST[dat8.5$Year==1800], dat8.5$Arag[dat8.5$Year==1800], pch=19, col=adjustcolor("black", 0.5))

points(dat8.5$SST[dat8.5$Year==2000], dat8.5$Arag[dat8.5$Year==2000], pch=17, col=adjustcolor("lightblue", 0.2))

points(dat8.5$SST[dat8.5$Year==2100], dat8.5$Arag[dat8.5$Year==2100], pch=22, col=adjustcolor("darkorange", 0.1), bg=adjustcolor("yellow", 0.2))
```

The last plot results in a hard to see pattern. Subset to points with unique x,y values:
```{r}
summary(dat8.5$SST)
summary(dat8.5$Arag)

ab=matrix(c(-5, 40, 0,12), nrow=2, byrow=TRUE)
nbin = c(100,100)
x <- seq(ab[1,1], ab[1,2], length.out = nbin[1])
y <- seq(ab[2,1], ab[2,2], length.out = nbin[2])

## 1800 layer
  y1800 <- bin2(cbind(dat8.5$SST[dat8.5$Year==1800], dat8.5$Arag[dat8.5$Year==1800]) , ab, nbin)
  z_1800 <- y1800$nc
  z_1800[z_1800>0] <- 1 # convert to presence/absence

## 2000 layer
  y2000 <- bin2(cbind(dat8.5$SST[dat8.5$Year==2000], dat8.5$Arag[dat8.5$Year==2000]) , ab, nbin)
  z_2000 <- y2000$nc
  z_2000[z_2000>0] <- 1 # convert to presence/absence
 
## 2100 layer 8.5
  y2100_8.5 <- bin2(cbind(dat8.5$SST[dat8.5$Year==2100], dat8.5$Arag[dat8.5$Year==2100]) , ab, nbin)
  z_2100_8.5 <- y2100_8.5$nc
  z_2100_8.5[z_2100_8.5>0] <- 1 # convert to presence/absence   
  
## 2100 layer 4.5
  y2100_4.5 <- bin2(cbind(dat4.5$SST[dat4.5$Year==2100], dat4.5$Arag[dat4.5$Year==2100]) , ab, nbin)
  z_2100_4.5 <- y2100_4.5$nc
  z_2100_4.5[z_2100_4.5>0] <- 1 # convert to presence/absence   

par(mar=c(4,4,0.5,0.5))  
# 1800 to 2000  
  image(x, y, z_1800, col=c("white", "dodgerblue4"),
        xlab="Temperature (C)",
        ylab="Aragonite Saturatation State",
        bty="l"
        )
  image(x, y, z_2000, add=TRUE, col=c(rgb(0,0,0,0), adjustcolor("goldenrod", 0.7)))
  text(20, 9.5, "1800 disappearing in 2000", col="dodgerblue4")  
  lines(c(20,25), c(9, 5.4), lwd=3, col=rgb(0,0,0,0.8))
  lines(c(20,5), c(9, 4), lwd=3, col=rgb(0,0,0,0.8))
  text(22, 0.5, "Novel in 2000", col="goldenrod", adj=0)  
  lines(c(25,30), c(1, 3.7), lwd=3, col=rgb(0,0,0,0.8))
  lines(c(25,17), c(1, 2.1), lwd=3, col=rgb(0,0,0,0.8))
  
    
# 2000 to 2100_8.5  
  image(x, y, z_2000, col=c(rgb(0,0,0,0), adjustcolor("goldenrod", 0.8)),
        xlab="Temperature (C)",
        ylab="Aragonite Saturatation State",
        bty="l",
        xlim=c(-5, 60)
        )
  image(x, y, z_2100_8.5, add=TRUE, col=c(rgb(0,0,0,0), adjustcolor("darkmagenta", 0.5)))
  text(20, 7.5, "2000 disappearing in\n2100 RCP 8.5", col="goldenrod4")  
  lines(c(20,20), c(6, 3), lwd=3, col="goldenrod4")
  lines(c(20,10), c(6, 2), lwd=3, col="goldenrod4")
  abline(1,0, lty=2, col=rgb(0,0,0,0.7))
  text(35, 2, "Novel in 2100\nRCP 8.5", col="darkmagenta", adj=0)  
  lines(c(35,32), c(2, 2.5), lwd=3, col="darkmagenta")
  lines(c(35,24), c(2, 1.8), lwd=3, col="darkmagenta")
  legend(40, 12, c("2000", "2100"), fill=c(adjustcolor("goldenrod", 0.8), 
         adjustcolor("darkmagenta", 0.5)), bty="n")
  

# 2000 to 2100_4.5  
  image(x, y, z_2000, col=c(rgb(0,0,0,0), adjustcolor("goldenrod", 1)),
        xlab="Temperature (C)",
        ylab="Aragonite Saturatation State",
        bty="l"
        )
  image(x, y, z_2100_4.5, add=TRUE, col=c(rgb(0,0,0,0), adjustcolor("darkorange", 0.5)))
  

```
